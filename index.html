
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>WorkTime ‚Äì Stempel System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Farbe der Browserleiste / App-Thema -->
  <meta name="theme-color" content="#f0f2f5" />

  <!-- Manifest f√ºr PWA (falls vorhanden) -->
  <link rel="manifest" href="manifest.json" />

  <style>
    html, body {
      height: 100%;
    }
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      max-width: 1000px;
      margin: 0 auto;
      background: #f0f2f5;
      min-height: 100vh;
    }

    h2, h3 { margin-top: 12px; margin-bottom: 8px; }

    label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }

    input, select, button, textarea {
      padding: 10px;
      margin-top: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }

    select, input, textarea {
      width: 100%;
    }

    button {
      cursor: pointer;
      border-radius: 6px;
      border: none;
    }

    .btn-primary {
      background: #1976d2;
      color: #fff;
    }
    .btn-secondary {
      background: #eeeeee;
      color: #333;
    }
    .btn-danger {
      background: #d32f2f;
      color: #fff;
    }

    .section {
      border: 1px solid #ccc;
      padding: 14px;
      margin-top: 15px;
      border-radius: 10px;
      background: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }

    #status, #hoursInfo, #planHoursInfo {
      font-size: 14px;
      margin-top: 6px;
    }

    .employee-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 14px;
      padding: 4px 0;
      border-bottom: 1px solid #eee;
      gap: 8px;
    }
    .employee-row button {
      padding: 6px 10px;
      font-size: 12px;
      white-space: nowrap;
    }

    .warning {
      color: #d32f2f;
      font-weight: bold;
    }

    small {
      font-size: 12px;
      color: #555;
    }

    .grid {
      display: block;
    }
    @media (min-width: 900px) {
      .grid {
        display: grid;
        grid-template-columns: 1.1fr 1fr;
        gap: 16px;
        align-items: flex-start;
      }
    }

    .box {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 8px;
      background: #fafafa;
      margin-top: 10px;
    }

    /* HERO / BANNER */
    .hero {
      border-radius: 16px;
      background: #ffffff;
      margin-bottom: 20px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      display: flex;
      flex-direction: column;
    }
    .hero-top {
      display: flex;
      align-items: center;
      padding: 14px 16px 10px 16px;
      gap: 12px;
    }
    .hero-logo {
      width: 72px;
      height: 72px;
      border-radius: 16px;
      background: #f5f5f5;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      flex-shrink: 0;
    }
    .hero-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .hero-text-main {
      flex-grow: 1;
    }
    .hero-title {
      font-size: 22px;
      font-weight: 700;
      margin: 0 0 4px 0;
    }
    .hero-subtitle {
      margin: 0;
      font-size: 14px;
      color: #555;
    }
    .hero-lang {
      display: flex;
      gap: 6px;
    }
    .lang-btn {
      border-radius: 999px;
      padding: 6px 10px;
      border: none;
      background: #eeeeee;
      font-size: 12px;
      cursor: pointer;
    }
    .lang-btn.active {
      background: #1976d2;
      color: #fff;
    }

    .hero-bottom {
      padding: 8px 16px 14px 16px;
      border-top: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 8px;
    }
    .hero-bottom-left {
      font-size: 13px;
      color: #555;
    }
    .hero-tag {
      display: inline-block;
      background: #eeeeee;
      border-radius: 999px;
      padding: 3px 9px;
      font-size: 11px;
      margin-right: 4px;
      margin-top: 2px;
    }

    /* CHEF LOGIN ‚Äì ITALIENISCHE FARBEN */
    .chef-login-card {
      border-top: 4px solid #008c45;  /* gr√ºn */
      border-right: 4px solid #ce2b37; /* rot */
      border-radius: 12px;
      background: #ffffff;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    /* DATENSCHUTZ BOX */
    .legal-box {
      margin-top: 18px;
      padding: 14px;
      border-radius: 10px;
      background: #ffffff;
      border: 1px solid #ccc;
      box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    }
    .legal-box h3 {
      margin-top: 0;
    }

    /* FOOTER LINKS */
    .footer-links {
      text-align: center;
      margin: 18px 0 4px 0;
      font-size: 13px;
    }
    .footer-links a {
      color: #1976d2;
      text-decoration: none;
      margin: 0 4px;
    }
    .footer-links a:hover {
      text-decoration: underline;
    }

    /* MODAL */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .modal {
      background: #fff;
      max-width: 600px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border-radius: 10px;
      padding: 16px 18px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal h2 {
      margin-top: 0;
    }
    .modal-close {
      position: absolute;
      right: 10px;
      top: 10px;
      border: none;
      background: transparent;
      font-size: 20px;
      cursor: pointer;
    }

  </style>
</head>
<body>

  <!-- HERO / BANNER -->
  <header class="hero">
    <div class="hero-top">
      <div class="hero-logo">
        <!-- LOG√ìTIPO NEUTRO WorkTime ‚Äì faz upload como worktime-logo.png -->
        <img src="worktime-logo.png" alt="WorkTime Logo" />
      </div>
      <div class="hero-text-main">
        <p class="hero-title" data-i18n="heroTitle">Dienstplan</p>
        <p class="hero-subtitle" data-i18n="heroSubtitle">
          WorkTime ‚Äì Stempel System f√ºr Mitarbeiter und kleine Teams.
        </p>
      </div>
      <div class="hero-lang">
        <button class="lang-btn active" data-lang="de">DE</button>
        <button class="lang-btn" data-lang="pt">PT</button>
        <button class="lang-btn" data-lang="it">IT</button>
      </div>
    </div>
    <div class="hero-bottom">
      <div class="hero-bottom-left" data-i18n="heroBottomText">
        Lokal im Betrieb ¬∑ Keine Cloud ¬∑ Beliebig viele Mitarbeiter
      </div>
      <div>
        <span class="hero-tag" data-i18n="heroTag1">Stempeluhr</span>
        <span class="hero-tag" data-i18n="heroTag2">Dienstplan</span>
        <span class="hero-tag" data-i18n="heroTag3">WhatsApp</span>
      </div>
    </div>
  </header>

  <!-- CHEF LOGIN -->
  <div class="section chef-login-card">
    <h3 data-i18n="chefLoginTitle">Chef Login</h3>
    <label for="chefPinInput" data-i18n="chefPinLabel">PIN eingeben:</label>
    <input type="password" id="chefPinInput" placeholder="PIN" />

    <div style="display:flex; gap:8px; margin-top:8px;">
      <button id="btnChefLogin" class="btn-primary" style="flex:1;" data-i18n="btnLogin">
        Login
      </button>
      <button id="btnChefLogout" class="btn-secondary" style="flex:1;" data-i18n="btnLogout">
        Logout
      </button>
    </div>

    <p id="chefLoginStatus"></p>
    <small data-i18n="chefLoginHint">
      Nach erfolgreichem Login werden die Chef-Bereiche (Mitarbeiter verwalten, Dienstplan / WhatsApp, Export &amp; Datenschutz) freigeschaltet.
    </small>
  </div>

  <div class="grid">
    <!-- CHEF-BEREICH (nur nach Login sichtbar) -->
    <div id="chefArea" style="display:none;">

      <!-- Mitarbeiter verwalten -->
      <div class="section">
        <h3 data-i18n="manageEmployeesTitle">Mitarbeiter verwalten</h3>

        <label for="empName" data-i18n="empNameLabel">Name des Mitarbeiters:</label>
        <input type="text" id="empName" placeholder="z.B. Jo√£o, Maria, ..." />

        <label for="empPhone" data-i18n="empPhoneLabel">WhatsApp / Telefonnummer (optional):</label>
        <input type="text" id="empPhone" placeholder="z.B. 491701234567" />

        <button id="btnAddEmp" class="btn-primary" style="width:100%; margin-top:10px;" data-i18n="btnAddEmployee">
          Mitarbeiter hinzuf√ºgen
        </button>

        <div id="employeeList" style="margin-top:12px;">
          <!-- Liste der Mitarbeiter -->
        </div>

        <small data-i18n="manageEmployeesHint">
          Mitarbeiterliste, Stunden und √úberstunden werden lokal im Browser/Tablet gespeichert.
        </small>
      </div>

      <!-- Dienstplan & WhatsApp -->
      <div class="section">
        <h3 data-i18n="planTitle">Dienstplan &amp; WhatsApp</h3>

        <label for="planEmployeeSelect" data-i18n="planEmployeeSelectLabel">Mitarbeiter ausw√§hlen:</label>
        <select id="planEmployeeSelect">
          <option value="" data-i18n="optionSelectEmployee">-- Mitarbeiter w√§hlen --</option>
        </select>

        <div id="planHoursInfo">
          Stunden diesen Monat: 0 | √úberstundenkonto: 0
        </div>

        <label for="date" data-i18n="planDateLabel">Tag:</label>
        <input type="date" id="date" />

        <label for="timeFrom" data-i18n="planFromLabel">Von (Uhrzeit):</label>
        <input type="time" id="timeFrom" />

        <label for="timeTo" data-i18n="planToLabel">Bis (Uhrzeit):</label>
        <input type="time" id="timeTo" />

        <div class="box">
          <button id="btnPreview" class="btn-secondary" style="width:100%; margin-bottom:6px;" data-i18n="btnShowMessage">
            Nachricht anzeigen
          </button>
          <button id="btnWhatsapp" class="btn-primary" style="width:100%;" data-i18n="btnOpenWhatsapp">
            WhatsApp √∂ffnen
          </button>
          <p style="font-size:12px; margin-top:6px;" data-i18n="planWhatsappHint">
            WhatsApp wird mit vorbereiteter Nachricht ge√∂ffnet. Du entscheidest, ob du sendest.
          </p>
        </div>

        <div class="box">
          <b data-i18n="previewTitle">Vorschau Nachricht:</b>
          <p id="previewText" style="white-space: pre-wrap; margin-top: 8px;">
            (Noch keine Nachricht)
          </p>
        </div>
      </div>

      <!-- Monatsbericht -->
      <div class="section">
        <h3 data-i18n="monthReportTitle">Monatsbericht (Chef)</h3>
        <p style="font-size:13px; margin-bottom:8px;" data-i18n="monthReportDesc">
          √úbersicht aller Mitarbeiter f√ºr den aktuellen Monat.
        </p>

        <div id="monthlyReportContainer">
          <!-- Tabelle wird per JavaScript erzeugt -->
        </div>

        <button class="btn-primary" style="width:100%; margin-top:10px;" onclick="printMonthlyReport()" data-i18n="btnPrintReport">
          Drucken / als PDF speichern
        </button>
      </div>

      <!-- Monats-Export CSV/Excel -->
      <div class="section">
        <h3 data-i18n="csvExportTitle">Monats-Export (CSV / Excel)</h3>
        <p style="font-size:13px; margin-bottom:8px;" data-i18n="csvExportDesc">
          Export pro Mitarbeiter und Monat ‚Äì ideal f√ºr den Steuerberater. Die Datei kann in Excel, Google Sheets oder LibreOffice ge√∂ffnet werden.
        </p>

        <label for="exportEmployeeSelect" data-i18n="exportEmployeeLabel">Mitarbeiter ausw√§hlen:</label>
        <select id="exportEmployeeSelect">
          <option value="" data-i18n="optionSelectEmployee">-- Mitarbeiter w√§hlen --</option>
        </select>

        <label for="exportMonthSelect" style="margin-top:10px;" data-i18n="exportMonthLabel">Monat ausw√§hlen:</label>
        <select id="exportMonthSelect"></select>

        <button id="btnExportCsv" class="btn-primary" style="width:100%; margin-top:10px;" data-i18n="btnExportCsv">
          CSV / Excel exportieren
        </button>

        <p id="exportStatus" style="font-size:12px; margin-top:8px;"></p>
      </div>

      <!-- DATENSCHUTZ & NUTZUNG ‚Äì nur f√ºr Chef -->
      <div class="legal-box">
        <h3 data-i18n="legalTitle">Datenschutz &amp; Nutzungshinweise</h3>
        <p data-i18n="legalIntro">
          Dieses System speichert Daten nur lokal im Browser/Tablet des Betriebs. Es werden keine Daten auf externen Servern gespeichert.
        </p>
        <ol>
          <li data-i18n="legalPoint1">
            Datenschutz: Zugriff auf die gespeicherten Daten haben nur der Betrieb/Chef und die von ihm autorisierten Personen. Der Arbeitgeber ist daf√ºr verantwortlich, seine Mitarbeiter √ºber die Datenerfassung zu informieren.
          </li>
          <li data-i18n="legalPoint2">
            Nutzung &amp; Urheberrecht: Diese Anwendung ist nur f√ºr den lizenzierten Betrieb bestimmt. Eine Weitergabe, Vervielf√§ltigung, der Verkauf oder das Kopieren des Quellcodes und Designs an Dritte ohne ausdr√ºckliche schriftliche Zustimmung des Entwicklers ist untersagt.
          </li>
          <li data-i18n="legalPoint3">
            Haftungsausschluss: Die Anwendung unterst√ºtzt bei der Erfassung von Arbeitszeiten. Die rechtlich korrekte Lohnabrechnung und Einhaltung arbeitsrechtlicher Vorschriften bleiben in der Verantwortung des Arbeitgebers.
          </li>
        </ol>
      </div>

    </div>

    <!-- STEMPELUHR ‚Äì immer sichtbar -->
    <div>
      <div class="section">
        <h3 data-i18n="stempTitle">Stempeluhr (f√ºr Mitarbeiter)</h3>

        <label for="employeeSelect" data-i18n="stempEmployeeLabel">Mitarbeiter ausw√§hlen:</label>
        <select id="employeeSelect">
          <option value="" data-i18n="optionSelectEmployee">-- Mitarbeiter w√§hlen --</option>
        </select>

        <div id="hoursInfo">
          Stunden diesen Monat: 0 | √úberstundenkonto: 0
        </div>

        <div id="status" style="margin-top:6px;">Bereit zum Stempeln.</div>

        <button id="btnIn" class="btn-primary" style="width:100%; margin-top:10px;" data-i18n="btnClockIn">
          Einstempeln
        </button>
        <button id="btnOut" class="btn-secondary" style="width:100%; margin-top:8px;" data-i18n="btnClockOut">
          Ausstempeln
        </button>

        <button id="btnDeleteLast" class="btn-danger" style="width:100%; margin-top:8px;" data-i18n="btnDeleteLast">
          Letzten Eintrag l√∂schen
        </button>

        <button id="btnToggleLog" class="btn-secondary" style="width:100%; margin-top:10px;" data-i18n="btnShowToday">
          Heutige Eintr√§ge anzeigen
        </button>

        <div id="logBox" style="display:none; margin-top:10px;">
          <div id="log">
            <b data-i18n="todayEntriesTitle">Heutige Eintr√§ge:</b><br />
          </div>
        </div>

        <small data-i18n="stempRule">
          Regel: Maximal 40 Stunden im Monat. Alles dar√ºber geht ins √úberstundenkonto (Bank von Stunden).
        </small>
      </div>
    </div>
  </div>

  <!-- FOOTER LINKS -->
  <div class="footer-links">
    <a href="#" id="linkImpressum">Impressum</a> |
    <a href="#" id="linkDatenschutz">Datenschutz</a>
  </div>

  <!-- MODAL Impressum / Datenschutz -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <button class="modal-close" id="modalClose">&times;</button>
      <h2 id="modalTitle">Titel</h2>
      <div id="modalContent"></div>
    </div>
  </div>

  <script>
    // -------------------------------------------------------
    // GRUNDEINSTELLUNGEN
    // -------------------------------------------------------
    const CHEF_PIN = "1234"; // <- mudar para um PIN s√≥ teu!

    let employees = [];
    const MAX_HOURS_PER_MONTH = 40;

    const chefPinInput = document.getElementById('chefPinInput');
    const btnChefLogin = document.getElementById('btnChefLogin');
    const btnChefLogout = document.getElementById('btnChefLogout');
    const chefLoginStatus = document.getElementById('chefLoginStatus');
    const chefArea = document.getElementById('chefArea');

    const empNameInput = document.getElementById('empName');
    const empPhoneInput = document.getElementById('empPhone');
    const btnAddEmp = document.getElementById('btnAddEmp');
    const employeeListDiv = document.getElementById('employeeList');

    const employeeSelect = document.getElementById('employeeSelect');
    const statusEl = document.getElementById('status');
    const hoursInfoEl = document.getElementById('hoursInfo');
    const logEl = document.getElementById('log');
    const btnIn = document.getElementById('btnIn');
    const btnOut = document.getElementById('btnOut');
    const btnDeleteLast = document.getElementById('btnDeleteLast');
    const btnToggleLog = document.getElementById('btnToggleLog');
    const logBox = document.getElementById('logBox');

    const planEmployeeSelect = document.getElementById('planEmployeeSelect');
    const planHoursInfoEl = document.getElementById('planHoursInfo');
    const dateInput = document.getElementById('date');
    const timeFromInput = document.getElementById('timeFrom');
    const timeToInput = document.getElementById('timeTo');
    const btnPreview = document.getElementById('btnPreview');
    const btnWhatsapp = document.getElementById('btnWhatsapp');
    const previewText = document.getElementById('previewText');

    const exportEmployeeSelect = document.getElementById('exportEmployeeSelect');
    const exportMonthSelect = document.getElementById('exportMonthSelect');
    const btnExportCsv = document.getElementById('btnExportCsv');
    const exportStatus = document.getElementById('exportStatus');

    // Modal
    const modalOverlay = document.getElementById('modalOverlay');
    const modalClose = document.getElementById('modalClose');
    const modalTitle = document.getElementById('modalTitle');
    const modalContent = document.getElementById('modalContent');
    const linkImpressum = document.getElementById('linkImpressum');
    const linkDatenschutz = document.getElementById('linkDatenschutz');

    // -------------------------------------------------------
    // DATUM / ZEIT HILFSFUNKTIONEN
    // -------------------------------------------------------
    function getCurrentMonthKey(date = new Date()) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      return `${y}-${m}`;
    }

    function formatDateYYYYMMDD(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}-${m}-${d}`;
    }

    function formatGermanDate(dateStr) {
      if (!dateStr) return "";
      const d = new Date(dateStr + "T00:00:00");
      return d.toLocaleDateString("de-DE", {
        weekday: "short",
        day: "2-digit",
        month: "2-digit",
        year: "numeric"
      });
    }

    // -------------------------------------------------------
    // LOKALER SPEICHER
    // -------------------------------------------------------
    function loadEmployees() {
      const data = localStorage.getItem('worktimeEmployees');
      if (data) {
        employees = JSON.parse(data);
      } else {
        employees = [];
      }
    }

    function saveEmployees() {
      localStorage.setItem('worktimeEmployees', JSON.stringify(employees));
    }

    function generateId() {
      return 'emp_' + Math.random().toString(36).substring(2, 9);
    }

    // -------------------------------------------------------
    // STUNDEN & BANK
    // -------------------------------------------------------
    function getHoursAndBank(emp, monthKey = getCurrentMonthKey()) {
      const total = (emp.monthlyHours && emp.monthlyHours[monthKey]) || 0;
      const bank  = (emp.timeBank && emp.timeBank[monthKey]) || 0;
      return { total, bank };
    }

    function updateHoursInfo() {
      const empId = employeeSelect.value;
      const emp = employees.find(e => e.id === empId);
      if (!emp) {
        hoursInfoEl.innerHTML = 'Stunden diesen Monat: 0 | √úberstundenkonto: 0';
        return;
      }
      const { total, bank } = getHoursAndBank(emp);
      let text = `Stunden diesen Monat: ${total.toFixed(2)} | √úberstundenkonto: ${bank.toFixed(2)}`;
      if (total > MAX_HOURS_PER_MONTH) {
        text += ' ‚Äì <span class="warning">Limit 40h √ºberschritten!</span>';
      }
      hoursInfoEl.innerHTML = text;
    }

    function updatePlanHoursInfo() {
      const empId = planEmployeeSelect.value;
      const emp = employees.find(e => e.id === empId);
      if (!emp) {
        planHoursInfoEl.innerHTML = 'Stunden diesen Monat: 0 | √úberstundenkonto: 0';
        return;
      }
      const { total, bank } = getHoursAndBank(emp);
      let text = `Stunden diesen Monat: ${total.toFixed(2)} | √úberstundenkonto: ${bank.toFixed(2)}`;
      if (total > MAX_HOURS_PER_MONTH) {
        text += ' ‚Äì <span class="warning">Limit 40h √ºberschritten!</span>';
      }
      planHoursInfoEl.innerHTML = text;
    }

    function addLog(text) {
      const now = new Date().toLocaleString();
      logEl.innerHTML += `${text} ‚Äì <i>${now}</i><br>`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    function deleteLastLogEntry() {
      const html = logEl.innerHTML;
      const lastBreak = html.lastIndexOf('<br>');
      if (lastBreak <= 0) return;
      const before = html.substring(0, lastBreak);
      const secondLast = before.lastIndexOf('<br>');
      if (secondLast <= 0) return;
      logEl.innerHTML = html.substring(0, secondLast + 4); // + <br>
    }

    // -------------------------------------------------------
    // UI F√úR MITARBEITERLISTE
    // -------------------------------------------------------
    function refreshEmployeeUI() {
      employeeSelect.innerHTML = '<option value="">-- Mitarbeiter w√§hlen --</option>';
      planEmployeeSelect.innerHTML = '<option value="">-- Mitarbeiter w√§hlen --</option>';
      exportEmployeeSelect.innerHTML = '<option value="">-- Mitarbeiter w√§hlen --</option>';

      employees.forEach(emp => {
        const opt1 = document.createElement('option');
        opt1.value = emp.id;
        opt1.textContent = emp.name;
        employeeSelect.appendChild(opt1);

        const opt2 = document.createElement('option');
        opt2.value = emp.id;
        opt2.textContent = emp.name;
        planEmployeeSelect.appendChild(opt2);

        const opt3 = document.createElement('option');
        opt3.value = emp.id;
        opt3.textContent = emp.name;
        exportEmployeeSelect.appendChild(opt3);
      });

      employeeListDiv.innerHTML = '';
      employees.forEach(emp => {
        const row = document.createElement('div');
        row.className = 'employee-row';

        let phoneMasked = emp.phone || '';
        if (phoneMasked.length > 4) {
          phoneMasked = phoneMasked.slice(0, 4) + '‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
        }

        row.innerHTML = `
          <span>${emp.name} ${emp.phone ? '(' + phoneMasked + ')' : ''}</span>
        `;
        const btnDel = document.createElement('button');
        btnDel.textContent = 'L√∂schen';
        btnDel.className = 'btn-danger';
        btnDel.onclick = () => {
          if (confirm('Mitarbeiter "' + emp.name + '" wirklich l√∂schen?')) {
            employees = employees.filter(e => e.id !== emp.id);
            saveEmployees();
            refreshEmployeeUI();
            updateHoursInfo();
            updatePlanHoursInfo();
            renderMonthlyReport();
          }
        };
        row.appendChild(btnDel);
        employeeListDiv.appendChild(row);
      });

      const disabled = employees.length === 0;
      btnIn.disabled = disabled;
      btnOut.disabled = disabled;
      btnDeleteLast.disabled = disabled;
      if (disabled) {
        statusEl.textContent = 'Keine Mitarbeiter angelegt. Chef muss zuerst Mitarbeiter hinzuf√ºgen.';
      } else {
        statusEl.textContent = 'Bereit zum Stempeln.';
      }
    }

    employeeSelect.addEventListener('change', () => {
      updateHoursInfo();
      const empId = employeeSelect.value;
      const emp = employees.find(e => e.id === empId);
      if (emp && emp.activeSessionStart) {
        statusEl.textContent = 'Mitarbeiter ist aktuell eingestempelt (seit ' +
          new Date(emp.activeSessionStart).toLocaleString() + ').';
      } else {
        statusEl.textContent = 'Bereit zum Stempeln.';
      }
    });

    planEmployeeSelect.addEventListener('change', () => {
      updatePlanHoursInfo();
    });

    // -------------------------------------------------------
    // CHEF LOGIN / LOGOUT
    // -------------------------------------------------------
    btnChefLogin.addEventListener('click', () => {
      const pin = chefPinInput.value.trim();
      if (pin === CHEF_PIN) {
        chefArea.style.display = 'block';
        chefLoginStatus.style.color = 'green';
        chefLoginStatus.textContent = 'Login erfolgreich. Chef-Bereiche sind freigeschaltet.';
        chefPinInput.value = '';
      } else {
        chefLoginStatus.style.color = 'red';
        chefLoginStatus.textContent = 'Falscher PIN.';
      }
    });

    btnChefLogout.addEventListener('click', () => {
      chefArea.style.display = 'none';
      chefLoginStatus.style.color = '#333';
      chefLoginStatus.textContent = 'Logout erfolgreich.';
    });

    // -------------------------------------------------------
    // MITARBEITER HINZUF√úGEN
    // -------------------------------------------------------
    btnAddEmp.addEventListener('click', () => {
      const name = empNameInput.value.trim();
      const phone = empPhoneInput.value.trim();
      if (!name) {
        alert('Bitte einen Namen eingeben.');
        return;
      }
      const emp = {
        id: generateId(),
        name,
        phone: phone || '',
        monthlyHours: {},
        timeBank: {},
        activeSessionStart: null,
        sessions: [] // hier k√∂nnten einzelne Arbeits-Sessions gespeichert werden
      };
      employees.push(emp);
      saveEmployees();
      empNameInput.value = '';
      empPhoneInput.value = '';
      refreshEmployeeUI();
      renderMonthlyReport();
    });

    // -------------------------------------------------------
    // STEMPELUHR
    // -------------------------------------------------------
    btnIn.addEventListener('click', () => {
      const empId = employeeSelect.value;
      if (!empId) {
        alert('Bitte zuerst einen Mitarbeiter ausw√§hlen.');
        return;
      }
      const emp = employees.find(e => e.id === empId);
      if (!emp) return;

      if (emp.activeSessionStart) {
        alert('Dieser Mitarbeiter ist bereits eingestempelt.');
        return;
      }

      emp.activeSessionStart = new Date().toISOString();
      saveEmployees();
      statusEl.textContent = 'Eingestempelt um ' +
        new Date(emp.activeSessionStart).toLocaleString() + '.';
      addLog(emp.name + ' eingestempelt');

      updateHoursInfo();
      updatePlanHoursInfo();
    });

    btnOut.addEventListener('click', () => {
      const empId = employeeSelect.value;
      if (!empId) {
        alert('Bitte zuerst einen Mitarbeiter ausw√§hlen.');
        return;
      }
      const emp = employees.find(e => e.id === empId);
      if (!emp) return;

      if (!emp.activeSessionStart) {
        alert('Dieser Mitarbeiter ist noch nicht eingestempelt.');
        return;
      }

      const start = new Date(emp.activeSessionStart);
      const end = new Date();
      const diffMs = end - start;
      const hours = diffMs / 1000 / 60 / 60;

      const monthKey = getCurrentMonthKey();
      if (!emp.monthlyHours) emp.monthlyHours = {};
      if (!emp.timeBank) emp.timeBank = {};

      const prevTotal = emp.monthlyHours[monthKey] || 0;
      const newTotal = prevTotal + hours;
      emp.monthlyHours[monthKey] = newTotal;

      let bank = 0;
      if (newTotal > MAX_HOURS_PER_MONTH) {
        bank = newTotal - MAX_HOURS_PER_MONTH;
      }
      emp.timeBank[monthKey] = bank;

      emp.activeSessionStart = null;
      saveEmployees();

      statusEl.textContent = 'Ausgestempelt. Gearbeitete Zeit: ' +
        hours.toFixed(2) + ' Std. Gesamt in diesem Monat: ' +
        newTotal.toFixed(2) + ' Std.';
      addLog(emp.name + ' ausgestempelt (' + hours.toFixed(2) + ' Std.)');

      updateHoursInfo();
      updatePlanHoursInfo();
      renderMonthlyReport();
    });

    btnDeleteLast.addEventListener('click', () => {
      if (!confirm('Letzten Eintrag wirklich l√∂schen? (Nur Anzeige in "Heutige Eintr√§ge")')) return;
      deleteLastLogEntry();
    });

    btnToggleLog.addEventListener('click', () => {
      const visible = logBox.style.display === 'block';
      logBox.style.display = visible ? 'none' : 'block';
      btnToggleLog.textContent = visible ? 'Heutige Eintr√§ge anzeigen' : 'Heutige Eintr√§ge verbergen';
    });

    // -------------------------------------------------------
    // WHATSAPP / DIENSTPLAN
    // -------------------------------------------------------
    function buildMessage() {
      const empId = planEmployeeSelect.value;
      const emp = employees.find(e => e.id === empId);
      const date = dateInput.value;
      const tFrom = timeFromInput.value;
      const tTo = timeToInput.value;

      if (!emp || !date || !tFrom || !tTo) {
        return "";
      }

      const dateDE = formatGermanDate(date);
      const { total, bank } = getHoursAndBank(emp);

      let hoursLine =
        `Aktueller Monat: ${total.toFixed(2)} Std. (√úberstundenkonto: ${bank.toFixed(2)} Std.)`;
      if (total > MAX_HOURS_PER_MONTH) {
        hoursLine += " ‚Äì LIMIT 40h √ºberschritten!";
      }

      const msg =
        "WorkTime ‚Äì Dienstplan\n\n" +
        "Hallo " + emp.name + ",\n\n" +
        "dein Dienst:\n" +
        "üìÖ Datum: " + dateDE + "\n" +
        "‚è∞ Zeit: " + tFrom + " ‚Äì " + tTo + " Uhr\n\n" +
        hoursLine + "\n\n" +
        "Bitte best√§tige mit OK.";
      return msg;
    }

    btnPreview.addEventListener('click', () => {
      const msg = buildMessage();
      if (!msg) {
        alert("Bitte Mitarbeiter, Tag und Zeiten ausf√ºllen.");
        return;
      }
      previewText.textContent = msg;
    });

    btnWhatsapp.addEventListener('click', () => {
      const empId = planEmployeeSelect.value;
      const emp = employees.find(e => e.id === empId);
      const msg = buildMessage();

      if (!emp) {
        alert("Bitte Mitarbeiter w√§hlen.");
        return;
      }
      if (!msg) {
        alert("Bitte Tag und Zeiten eintragen.");
        return;
      }
      if (!emp.phone) {
        alert("F√ºr diesen Mitarbeiter ist keine Telefonnummer hinterlegt.");
        return;
      }

      const phone = emp.phone;
      const encodedMsg = encodeURIComponent(msg);
      const url = "https://wa.me/" + phone + "?text=" + encodedMsg;
      window.open(url, "_blank");
    });

    // -------------------------------------------------------
    // MONATSBERICHT
    // -------------------------------------------------------
    function renderMonthlyReport() {
      const container = document.getElementById('monthlyReportContainer');
      if (!container) return;

      if (!employees || employees.length === 0) {
        container.innerHTML = '<em>Keine Mitarbeiter angelegt.</em>';
        return;
      }

      const monthKey = getCurrentMonthKey();
      let html = '<table style="width:100%; border-collapse: collapse; font-size:14px;">';
      html += '<thead><tr>' +
              '<th style="border-bottom:1px solid #ccc; text-align:left; padding:4px;">Mitarbeiter</th>' +
              '<th style="border-bottom:1px solid #ccc; text-align:right; padding:4px;">Stunden im Monat</th>' +
              '<th style="border-bottom:1px solid #ccc; text-align:right; padding:4px;">√úberstundenkonto</th>' +
              '</tr></thead><tbody>';

      let totalHoursAll = 0;
      let totalBankAll = 0;

      employees.forEach(emp => {
        const { total, bank } = getHoursAndBank(emp, monthKey);
        totalHoursAll += total;
        totalBankAll += bank;

        html += '<tr>' +
          '<td style="border-bottom:1px solid #eee; padding:4px;">' + emp.name + '</td>' +
          '<td style="border-bottom:1px solid #eee; padding:4px; text-align:right;">' + total.toFixed(2) + '</td>' +
          '<td style="border-bottom:1px solid #eee; padding:4px; text-align:right;">' + bank.toFixed(2) + '</td>' +
          '</tr>';
      });

      html += '<tr>' +
        '<td style="padding:4px; font-weight:bold; text-align:right;">Summe:</td>' +
        '<td style="padding:4px; font-weight:bold; text-align:right;">' + totalHoursAll.toFixed(2) + '</td>' +
        '<td style="padding:4px; font-weight:bold; text-align:right;">' + totalBankAll.toFixed(2) + '</td>' +
        '</tr>';

      html += '</tbody></table>';
      container.innerHTML = html;
    }

    function printMonthlyReport() {
      const container = document.getElementById('monthlyReportContainer');
      if (!container) return;

      const win = window.open('', '_blank');
      win.document.write('<html><head><title>Monatsbericht ‚Äì WorkTime</title>');
      win.document.write('<meta charset="UTF-8">');
      win.document.write('<style>body{font-family:Arial,sans-serif;padding:16px;} table{width:100%;border-collapse:collapse;font-size:14px;} th,td{border:1px solid #ccc;padding:4px;} th{text-align:left;background:#f0f0f0;}</style>');
      win.document.write('</head><body>');
      win.document.write('<h2>Monatsbericht ‚Äì WorkTime</h2>');
      win.document.write('<p>Monat: ' + getCurrentMonthKey() + '</p>');
      win.document.write(container.innerHTML);
      win.document.write('</body></html>');
      win.document.close();
      win.focus();
      win.print();
    }

    // -------------------------------------------------------
    // CSV / EXCEL EXPORT PRO MITARBEITER & MONAT
    // -------------------------------------------------------
    function fillExportMonthSelect() {
      exportMonthSelect.innerHTML = '';
      const now = new Date();
      for (let i = 0; i < 12; i++) {
        const d = new Date(now.getFullYear(), now.getMonth() - i, 1);
        const key = getCurrentMonthKey(d);
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = d.toLocaleString('de-DE', { month: 'long', year: 'numeric' });
        exportMonthSelect.appendChild(opt);
      }
    }

    btnExportCsv.addEventListener('click', () => {
      const empId = exportEmployeeSelect.value;
      const monthKey = exportMonthSelect.value;
      if (!empId || !monthKey) {
        alert('Bitte Mitarbeiter und Monat w√§hlen.');
        return;
      }
      const emp = employees.find(e => e.id === empId);
      if (!emp) return;

      // CSV-Kopf
      let csv = 'Name;' + emp.name + ';Monat;' + monthKey + '\n';
      csv += 'Tag;Arbeitsbeginn;Arbeitsende;Pausenbeginn;Pausenende;Arbeitszeit;Entlohnungsart\n';

      const [year, month] = monthKey.split('-');
      const firstDay = new Date(parseInt(year), parseInt(month) - 1, 1);
      const lastDay = new Date(parseInt(year), parseInt(month), 0);

      for (let d = firstDay; d <= lastDay; d.setDate(d.getDate() + 1)) {
        const tag = d.toLocaleDateString('de-DE');
        csv += `${tag};;;;;;\n`;
      }

      const { total, bank } = getHoursAndBank(emp, monthKey);
      csv += `;;;Gesamtstunden;${total.toFixed(2)};;\n`;
      csv += `;;;√úberstundenkonto (Monat);${bank.toFixed(2)};;\n`;

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      const fileName = `stunden_${emp.name.replace(/\s+/g,'_')}_${monthKey}.csv`;
      link.setAttribute('href', url);
      link.setAttribute('download', fileName);
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);

      exportStatus.textContent = 'Export erstellt: ' + fileName;
    });

    // -------------------------------------------------------
    // MODAL Impressum / Datenschutz (Platzhalter-Texte)
    // -------------------------------------------------------
    linkImpressum.addEventListener('click', (e) => {
      e.preventDefault();
      modalTitle.textContent = 'Impressum';
      modalContent.innerHTML = `
        <p><b>WorkTime ‚Äì Stempel System</b><br>
        Anbieter: [Dein Name / Deine Firma]<br>
        Adresse: [Stra√üe, PLZ, Ort]<br>
        Kontakt: [Telefon / E-Mail]</p>
        <p>Dieses Tool wird als einfache Zeiterfassung f√ºr kleine Betriebe angeboten.
        Es werden keine Daten auf externen Servern gespeichert.</p>
      `;
      modalOverlay.style.display = 'flex';
    });

    linkDatenschutz.addEventListener('click', (e) => {
      e.preventDefault();
      modalTitle.textContent = 'Datenschutz';
      modalContent.innerHTML = `
        <p>Alle Daten (Mitarbeiterliste, Arbeitszeiten, √úberstunden) werden ausschlie√ülich
        lokal im Browser/Tablet gespeichert. Es findet keine √úbertragung an externe Server statt.</p>
        <p>Der Arbeitgeber ist f√ºr die Information seiner Mitarbeiter √ºber die Datenerfassung
        und die Einhaltung der geltenden Datenschutzgesetze verantwortlich.</p>
      `;
      modalOverlay.style.display = 'flex';
    });

    modalClose.addEventListener('click', () => {
      modalOverlay.style.display = 'none';
    });
    modalOverlay.addEventListener('click', (e) => {
      if (e.target === modalOverlay) modalOverlay.style.display = 'none';
    });

    // -------------------------------------------------------
    // SPRACHUMSCHALTUNG (DE / PT / IT) ‚Äì einfache Variante
    // -------------------------------------------------------
    const translations = {
      de: {
        heroTitle: "Dienstplan",
        heroSubtitle: "WorkTime ‚Äì Stempel System f√ºr Mitarbeiter und kleine Teams.",
        heroBottomText: "Lokal im Betrieb ¬∑ Keine Cloud ¬∑ Beliebig viele Mitarbeiter",
        heroTag1: "Stempeluhr",
        heroTag2: "Dienstplan",
        heroTag3: "WhatsApp",

        chefLoginTitle: "Chef Login",
        chefPinLabel: "PIN eingeben:",
        btnLogin: "Login",
        btnLogout: "Logout",
        chefLoginHint: "Nach erfolgreichem Login werden die Chef-Bereiche (Mitarbeiter verwalten, Dienstplan / WhatsApp, Export & Datenschutz) freigeschaltet.",

        manageEmployeesTitle: "Mitarbeiter verwalten",
        empNameLabel: "Name des Mitarbeiters:",
        empPhoneLabel: "WhatsApp / Telefonnummer (optional):",
        btnAddEmployee: "Mitarbeiter hinzuf√ºgen",
        manageEmployeesHint: "Mitarbeiterliste, Stunden und √úberstunden werden lokal im Browser/Tablet gespeichert.",

        planTitle: "Dienstplan & WhatsApp",
        planEmployeeSelectLabel: "Mitarbeiter ausw√§hlen:",
        planDateLabel: "Tag:",
        planFromLabel: "Von (Uhrzeit):",
        planToLabel: "Bis (Uhrzeit):",
        btnShowMessage: "Nachricht anzeigen",
        btnOpenWhatsapp: "WhatsApp √∂ffnen",
        planWhatsappHint: "WhatsApp wird mit vorbereiteter Nachricht ge√∂ffnet. Du entscheidest, ob du sendest.",
        previewTitle: "Vorschau Nachricht:",

        monthReportTitle: "Monatsbericht (Chef)",
        monthReportDesc: "√úbersicht aller Mitarbeiter f√ºr den aktuellen Monat.",
        btnPrintReport: "Drucken / als PDF speichern",

        csvExportTitle: "Monats-Export (CSV / Excel)",
        csvExportDesc: "Export pro Mitarbeiter und Monat ‚Äì ideal f√ºr den Steuerberater. Die Datei kann in Excel, Google Sheets oder LibreOffice ge√∂ffnet werden.",
        exportEmployeeLabel: "Mitarbeiter ausw√§hlen:",
        exportMonthLabel: "Monat ausw√§hlen:",
        btnExportCsv: "CSV / Excel exportieren",

        legalTitle: "Datenschutz & Nutzungshinweise",
        legalIntro: "Dieses System speichert Daten nur lokal im Browser/Tablet des Betriebs. Es werden keine Daten auf externen Servern gespeichert.",
        legalPoint1: "Datenschutz: Zugriff auf die gespeicherten Daten haben nur der Betrieb/Chef und die von ihm autorisierten Personen. Der Arbeitgeber ist daf√ºr verantwortlich, seine Mitarbeiter √ºber die Datenerfassung zu informieren.",
        legalPoint2: "Nutzung & Urheberrecht: Diese Anwendung ist nur f√ºr den lizenzierten Betrieb bestimmt. Eine Weitergabe, Vervielf√§ltigung, der Verkauf oder das Kopieren des Quellcodes und Designs an Dritte ohne ausdr√ºckliche schriftliche Zustimmung des Entwicklers ist untersagt.",
        legalPoint3: "Haftungsausschluss: Die Anwendung unterst√ºtzt bei der Erfassung von Arbeitszeiten. Die rechtlich korrekte Lohnabrechnung und Einhaltung arbeitsrechtlicher Vorschriften bleiben in der Verantwortung des Arbeitgebers.",

        stempTitle: "Stempeluhr (f√ºr Mitarbeiter)",
        stempEmployeeLabel: "Mitarbeiter ausw√§hlen:",
        btnClockIn: "Einstempeln",
        btnClockOut: "Ausstempeln",
        btnDeleteLast: "Letzten Eintrag l√∂schen",
        btnShowToday: "Heutige Eintr√§ge anzeigen",
        todayEntriesTitle: "Heutige Eintr√§ge:",
        stempRule: "Regel: Maximal 40 Stunden im Monat. Alles dar√ºber geht ins √úberstundenkonto (Bank von Stunden).",

        optionSelectEmployee: "-- Mitarbeiter w√§hlen --"
      },
      pt: {
        heroTitle: "Planeamento de Turnos",
        heroSubtitle: "WorkTime ‚Äì Sistema de ponto e gest√£o de pessoal.",
        heroBottomText: "Local no estabelecimento ¬∑ Sem cloud ¬∑ Funcion√°rios ilimitados",
        heroTag1: "Rel√≥gio de ponto",
        heroTag2: "Turnos",
        heroTag3: "WhatsApp",

        chefLoginTitle: "Login do Chefe",
        chefPinLabel: "Introduzir PIN:",
        btnLogin: "Entrar",
        btnLogout: "Sair",
        chefLoginHint: "Ap√≥s o login s√£o ativadas as √°reas do chefe (gest√£o de funcion√°rios, turnos / WhatsApp, exporta√ß√£o & prote√ß√£o de dados).",

        manageEmployeesTitle: "Gerir funcion√°rios",
        empNameLabel: "Nome do funcion√°rio:",
        empPhoneLabel: "WhatsApp / N√∫mero de telefone (opcional):",
        btnAddEmployee: "Adicionar funcion√°rio",
        manageEmployeesHint: "Lista de funcion√°rios, horas e banco de horas s√£o guardados apenas localmente no tablet/navegador.",

        planTitle: "Turnos & WhatsApp",
        planEmployeeSelectLabel: "Escolher funcion√°rio:",
        planDateLabel: "Dia:",
        planFromLabel: "Das (hora):",
        planToLabel: "At√© (hora):",
        btnShowMessage: "Mostrar mensagem",
        btnOpenWhatsapp: "Abrir WhatsApp",
        planWhatsappHint: "O WhatsApp abre com a mensagem preparada. Tu decides se queres enviar.",
        previewTitle: "Pr√©-visualiza√ß√£o da mensagem:",

        monthReportTitle: "Relat√≥rio mensal (Chefe)",
        monthReportDesc: "Resumo de todos os funcion√°rios no m√™s atual.",
        btnPrintReport: "Imprimir / guardar como PDF",

        csvExportTitle: "Exporta√ß√£o mensal (CSV / Excel)",
        csvExportDesc: "Exporta√ß√£o por funcion√°rio e m√™s ‚Äì ideal para o contabilista. O ficheiro pode ser aberto no Excel, Google Sheets ou LibreOffice.",
        exportEmployeeLabel: "Escolher funcion√°rio:",
        exportMonthLabel: "Escolher m√™s:",
        btnExportCsv: "Exportar CSV / Excel",

        legalTitle: "Prote√ß√£o de dados & utiliza√ß√£o",
        legalIntro: "Este sistema guarda os dados apenas localmente no tablet/navegador do estabelecimento. N√£o s√£o guardados dados em servidores externos.",
        legalPoint1: "Prote√ß√£o de dados: Apenas o estabelecimento/chefe e pessoas autorizadas t√™m acesso aos dados guardados. O empregador √© respons√°vel por informar os funcion√°rios sobre o registo de dados.",
        legalPoint2: "Utiliza√ß√£o & direitos de autor: Esta aplica√ß√£o √© apenas para o estabelecimento licenciado. √â proibida a ced√™ncia, c√≥pia, venda ou reprodu√ß√£o do c√≥digo e design sem autoriza√ß√£o escrita do desenvolvedor.",
        legalPoint3: "Isen√ß√£o de responsabilidade: A aplica√ß√£o ajuda apenas no registo de horas. A folha salarial correta e o cumprimento das leis laborais s√£o responsabilidade do empregador.",

        stempTitle: "Rel√≥gio de ponto (funcion√°rios)",
        stempEmployeeLabel: "Escolher funcion√°rio:",
        btnClockIn: "Entrar",
        btnClockOut: "Sair",
        btnDeleteLast: "Apagar √∫ltimo registo",
        btnShowToday: "Mostrar registos de hoje",
        todayEntriesTitle: "Registos de hoje:",
        stempRule: "Regra: M√°ximo 40 horas por m√™s. O que passar entra no banco de horas.",

        optionSelectEmployee: "-- Escolher funcion√°rio --"
      },
      it: {
        heroTitle: "Pianificazione turni",
        heroSubtitle: "WorkTime ‚Äì Sistema di timbratura per piccoli team.",
        heroBottomText: "Locale nel locale ¬∑ Nessun cloud ¬∑ Dipendenti illimitati",
        heroTag1: "Timbratura",
        heroTag2: "Turni",
        heroTag3: "WhatsApp",

        chefLoginTitle: "Login responsabile",
        chefPinLabel: "Inserire PIN:",
        btnLogin: "Login",
        btnLogout: "Logout",
        chefLoginHint: "Dopo il login si attivano le aree del responsabile (gestione dipendenti, turni / WhatsApp, export & privacy).",

        manageEmployeesTitle: "Gestione dipendenti",
        empNameLabel: "Nome del dipendente:",
        empPhoneLabel: "WhatsApp / Numero di telefono (opzionale):",
        btnAddEmployee: "Aggiungi dipendente",
        manageEmployeesHint: "Elenco dipendenti, ore lavorate e banca ore sono salvati solo localmente sul tablet/browser.",

        planTitle: "Turni & WhatsApp",
        planEmployeeSelectLabel: "Seleziona dipendente:",
        planDateLabel: "Giorno:",
        planFromLabel: "Dalle (ora):",
        planToLabel: "Alle (ora):",
        btnShowMessage: "Mostra messaggio",
        btnOpenWhatsapp: "Apri WhatsApp",
        planWhatsappHint: "WhatsApp si apre con il messaggio preparato. Decidi tu se inviarlo.",
        previewTitle: "Anteprima messaggio:",

        monthReportTitle: "Report mensile (Responsabile)",
        monthReportDesc: "Panoramica di tutti i dipendenti per il mese corrente.",
        btnPrintReport: "Stampa / salva come PDF",

        csvExportTitle: "Export mensile (CSV / Excel)",
        csvExportDesc: "Export per dipendente e mese ‚Äì ideale per il commercialista. Il file pu√≤ essere aperto in Excel, Google Sheets o LibreOffice.",
        exportEmployeeLabel: "Seleziona dipendente:",
        exportMonthLabel: "Seleziona mese:",
        btnExportCsv: "Esporta CSV / Excel",

        legalTitle: "Protezione dati & utilizzo",
        legalIntro: "Questo sistema salva i dati solo localmente sul tablet/browser dell‚Äôesercizio. Nessun dato viene salvato su server esterni.",
        legalPoint1: "Protezione dati: Solo l‚Äôesercizio/il responsabile e le persone autorizzate hanno accesso ai dati salvati. Il datore di lavoro √® responsabile di informare i dipendenti sulla raccolta dei dati.",
        legalPoint2: "Utilizzo & copyright: L‚Äôapplicazione √® destinata solo all‚Äôesercizio licenziatario. √à vietata la cessione, copia, vendita o riproduzione del codice e del design senza autorizzazione scritta dello sviluppatore.",
        legalPoint3: "Esclusione di responsabilit√†: L‚Äôapplicazione supporta solo la registrazione delle ore. Il calcolo corretto delle paghe e il rispetto delle norme sul lavoro restano responsabilit√† del datore di lavoro.",

        stempTitle: "Timbratura (per dipendenti)",
        stempEmployeeLabel: "Seleziona dipendente:",
        btnClockIn: "Entrata",
        btnClockOut: "Uscita",
        btnDeleteLast: "Cancella ultima registrazione",
        btnShowToday: "Mostra registrazioni di oggi",
        todayEntriesTitle: "Registrazioni di oggi:",
        stempRule: "Regola: Massimo 40 ore al mese. Il resto va nella banca ore.",

        optionSelectEmployee: "-- Seleziona dipendente --"
      }
    };

    function applyTranslations(lang) {
      const dict = translations[lang] || translations.de;
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (dict[key]) el.textContent = dict[key];
      });
      document.querySelectorAll('#employeeSelect option[value=""], #planEmployeeSelect option[value=""], #exportEmployeeSelect option[value=""]').forEach(opt => {
        opt.textContent = dict.optionSelectEmployee || "-- Mitarbeiter w√§hlen --";
      });
    }

    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const lang = btn.getAttribute('data-lang');
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        applyTranslations(lang);
      });
    });

    // -------------------------------------------------------
    // INIT
    // -------------------------------------------------------
    function init() {
      loadEmployees();
      refreshEmployeeUI();
      updateHoursInfo();
      updatePlanHoursInfo();
      renderMonthlyReport();
      fillExportMonthSelect();
      applyTranslations('de');
    }

    init();

    // Service Worker (optional, falls vorhanden)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js').catch(err => {
        console.error('ServiceWorker-Fehler:', err);
      });
    }
  </script>
</body>
</html>
